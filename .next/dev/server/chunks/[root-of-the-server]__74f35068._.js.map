{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///E:/React%20Projects/NEXTJS%20PROJECTS/OZONE/ozone-water-1/lib/db.js"],"sourcesContent":["import mongoose from \"mongoose\";\r\n\r\nconst connectionDb = async () => {\r\n  if (mongoose.connections[0].readyState) {\r\n    console.log(\"MongoDB already connected\");\r\n    return;\r\n  }\r\n\r\n  try {\r\n    await mongoose.connect(process.env.MONGO_URI); \r\n    console.log(\"MongoDB connected successfully\");\r\n  } catch (err) {\r\n    console.error(\"MongoDB connection failed:\", err);\r\n    throw err;\r\n  }\r\n};\r\n\r\nexport default connectionDb;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,eAAe;IACnB,IAAI,oHAAQ,CAAC,WAAW,CAAC,EAAE,CAAC,UAAU,EAAE;QACtC,QAAQ,GAAG,CAAC;QACZ;IACF;IAEA,IAAI;QACF,MAAM,oHAAQ,CAAC,OAAO,CAAC,QAAQ,GAAG,CAAC,SAAS;QAC5C,QAAQ,GAAG,CAAC;IACd,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,MAAM;IACR;AACF;uCAEe"}},
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///E:/React%20Projects/NEXTJS%20PROJECTS/OZONE/ozone-water-1/models/Stock.js"],"sourcesContent":["import mongoose from \"mongoose\";\r\n\r\nconst StockSchema = new mongoose.Schema({\r\n    productSize: {\r\n        type: String,\r\n        required: true, \r\n    },\r\n    producyType: {\r\n        type: String,\r\n        required: true,\r\n        enum: [\"bottle\", \"pet\"],\r\n    },\r\n    quantity: {\r\n        type: Number,\r\n        required: true,\r\n        default: 0,\r\n    },\r\n    costPerType: {\r\n        type: Number,\r\n        required: true,\r\n    },\r\n}, { timestamps: true });\r\n\r\nconst Stock = mongoose.models.Stock || mongoose.model(\"Stock\", StockSchema);\r\nexport default Stock;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,IAAI,oHAAQ,CAAC,MAAM,CAAC;IACpC,aAAa;QACT,MAAM;QACN,UAAU;IACd;IACA,aAAa;QACT,MAAM;QACN,UAAU;QACV,MAAM;YAAC;YAAU;SAAM;IAC3B;IACA,UAAU;QACN,MAAM;QACN,UAAU;QACV,SAAS;IACb;IACA,aAAa;QACT,MAAM;QACN,UAAU;IACd;AACJ,GAAG;IAAE,YAAY;AAAK;AAEtB,MAAM,QAAQ,oHAAQ,CAAC,MAAM,CAAC,KAAK,IAAI,oHAAQ,CAAC,KAAK,CAAC,SAAS;uCAChD"}},
    {"offset": {"line": 107, "column": 0}, "map": {"version":3,"sources":["file:///E:/React%20Projects/NEXTJS%20PROJECTS/OZONE/ozone-water-1/src/app/api/stock/route.js"],"sourcesContent":["import connectionDb from \"../../../../lib/db\";\r\nimport Stock from \"../../../../models/Stock\";\r\n\r\nexport async function POST(request) {\r\n  try {\r\n    await connectionDb();\r\n    const { productSize, producyType, quantity, costPerType } =\r\n      await request.json();\r\n\r\n    if (\r\n      !productSize ||\r\n      !producyType ||\r\n      quantity === undefined ||\r\n      costPerType === undefined\r\n    ) {\r\n      return new Response(\r\n        JSON.stringify({ message: \"All fields are required\" }),\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Check if stock with same productSize and producyType already exists\r\n    const existingStock = await Stock.findOne({ productSize, producyType });\r\n\r\n    if (existingStock) {\r\n      existingStock.quantity += Number(quantity);\r\n      existingStock.costPerType = costPerType; // Update cost per type to latest\r\n      await existingStock.save();\r\n\r\n      return new Response(\r\n        JSON.stringify({\r\n          message: \"Stock updated successfully\",\r\n          stock: existingStock,\r\n          action: \"updated\",\r\n        }),\r\n        { status: 200 }\r\n      );\r\n    } else {\r\n      const newStock = new Stock({\r\n        productSize,\r\n        producyType,\r\n        quantity,\r\n        costPerType,\r\n      });\r\n      await newStock.save();\r\n\r\n      return new Response(\r\n        JSON.stringify({\r\n          message: \"Stock added successfully\",\r\n          stock: newStock,\r\n          action: \"created\",\r\n        }),\r\n        { status: 201 }\r\n      );\r\n    }\r\n  } catch (error) {\r\n    console.error(\"Error adding stock:\", error);\r\n    return new Response(JSON.stringify({ message: \"Internal Server Error\" }), {\r\n      status: 500,\r\n    });\r\n  }\r\n}\r\n\r\nexport async function GET(request) {\r\n  try {\r\n    await connectionDb();\r\n    const stocks = await Stock.find().sort({ createdAt: -1 });\r\n    return new Response(JSON.stringify({ stocks }), { status: 200 });\r\n  } catch (error) {\r\n    console.error(\"Error fetching stocks:\", error);\r\n    return new Response(JSON.stringify({ message: \"Internal Server Error\" }), {\r\n      status: 500,\r\n    });\r\n  }\r\n}\r\n\r\nexport async function PATCH(request) {\r\n  try {\r\n    await connectionDb();\r\n    const { productSize, producyType, quantityToReduce } = await request.json();\r\n\r\n    if (\r\n      !productSize ||\r\n      !producyType ||\r\n      quantityToReduce === undefined ||\r\n      quantityToReduce <= 0\r\n    ) {\r\n      return new Response(\r\n        JSON.stringify({\r\n          message:\r\n            \"Product size, product type, and valid quantity to reduce are required\",\r\n        }),\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Find the stock entry for this product size and type\r\n    const stock = await Stock.findOne({ productSize, producyType });\r\n\r\n    if (!stock) {\r\n      return new Response(\r\n        JSON.stringify({ message: \"No stock found for this product\" }),\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Check if sufficient stock is available\r\n    if (stock.quantity < quantityToReduce) {\r\n      return new Response(\r\n        JSON.stringify({\r\n          message: \"Insufficient stock\",\r\n          available: stock.quantity,\r\n          requested: quantityToReduce,\r\n        }),\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Reduce the quantity\r\n    stock.quantity -= quantityToReduce;\r\n    await stock.save();\r\n\r\n    return new Response(\r\n      JSON.stringify({\r\n        message: \"Stock reduced successfully\",\r\n        reducedQuantity: quantityToReduce,\r\n        remainingQuantity: stock.quantity,\r\n        updatedStock: stock,\r\n      }),\r\n      { status: 200 }\r\n    );\r\n  } catch (error) {\r\n    console.error(\"Error reducing stock:\", error);\r\n    return new Response(JSON.stringify({ message: \"Internal Server Error\" }), {\r\n      status: 500,\r\n    });\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}